services:
  frontend:
    image: nginx:1.25-alpine
    container_name: suda-gs-ams-frontend
    ports:
      - "80:80"

    # 从 .env 读取 API_UPSTREAM
    environment:
      - API_UPSTREAM=${API_UPSTREAM}

    volumes:
      # 前端 dist 静态文件
      - ./dist:/usr/share/nginx/html:ro

      # nginx 配置模板
      - ./deploy/nginx.conf.template:/etc/nginx/templates/default.conf.template:ro

    command: >
      /bin/sh -c "apk add --no-cache gettext
      && envsubst '$$API_UPSTREAM' < /etc/nginx/templates/default.conf.template > /etc/nginx/conf.d/default.conf
      && nginx -g 'daemon off;'"

    restart: unless-stopped
